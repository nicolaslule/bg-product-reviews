{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nimport { CheckIcon } from '@bigcommerce/big-design-icons';\nimport { useCombobox } from 'downshift';\nimport React, { cloneElement, createRef, Fragment, isValidElement, useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { Manager, Popper, Reference } from 'react-popper';\nimport { useUniqueId } from '../../hooks';\nimport { typedMemo, warning } from '../../utils';\nimport { Box } from '../Box';\nimport { Flex } from '../Flex';\nimport { FlexItem } from '../Flex/Item';\nimport { FormControlLabel } from '../Form';\nimport { Input } from '../Input';\nimport { List } from '../List';\nimport { ListGroupHeader } from '../List/GroupHeader';\nimport { ListItem } from '../List/Item';\nimport { Small } from '../Typography';\nimport { DropdownButton, StyledDropdownIcon, StyledInputContainer } from './styled';\nexport var Select = typedMemo(function (_ref) {\n  var action = _ref.action,\n      _ref$autoWidth = _ref.autoWidth,\n      autoWidth = _ref$autoWidth === void 0 ? false : _ref$autoWidth,\n      className = _ref.className,\n      disabled = _ref.disabled,\n      _ref$filterable = _ref.filterable,\n      filterable = _ref$filterable === void 0 ? true : _ref$filterable,\n      inputRef = _ref.inputRef,\n      id = _ref.id,\n      label = _ref.label,\n      labelId = _ref.labelId,\n      _ref$maxHeight = _ref.maxHeight,\n      maxHeight = _ref$maxHeight === void 0 ? 250 : _ref$maxHeight,\n      onOptionChange = _ref.onOptionChange,\n      options = _ref.options,\n      placeholder = _ref.placeholder,\n      _ref$placement = _ref.placement,\n      placement = _ref$placement === void 0 ? 'bottom-start' : _ref$placement,\n      _ref$positionFixed = _ref.positionFixed,\n      positionFixed = _ref$positionFixed === void 0 ? false : _ref$positionFixed,\n      required = _ref.required,\n      style = _ref.style,\n      value = _ref.value,\n      rest = _objectWithoutProperties(_ref, [\"action\", \"autoWidth\", \"className\", \"disabled\", \"filterable\", \"inputRef\", \"id\", \"label\", \"labelId\", \"maxHeight\", \"onOptionChange\", \"options\", \"placeholder\", \"placement\", \"positionFixed\", \"required\", \"style\", \"value\"]); // Merge options and action\n\n\n  var flattenedOptions = useMemo(function () {\n    return action ? [].concat(_toConsumableArray(flattenOptions(options)), [action]) : flattenOptions(options);\n  }, [action, options]);\n  var itemKey = useRef(0);\n  var findSelectedOption = useMemo(function () {\n    return flattenedOptions.find(function (option) {\n      return 'value' in option && option.value === value;\n    });\n  }, [flattenedOptions, value]);\n\n  var _useState = useState(flattenedOptions),\n      _useState2 = _slicedToArray(_useState, 2),\n      selectOptions = _useState2[0],\n      setSelectOptions = _useState2[1];\n\n  var _useState3 = useState(findSelectedOption ? findSelectedOption.content : ''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      inputValue = _useState4[0],\n      setInputValue = _useState4[1];\n\n  var _useState5 = useState(findSelectedOption),\n      _useState6 = _slicedToArray(_useState5, 2),\n      selectedOption = _useState6[0],\n      setSelectedOption = _useState6[1];\n\n  var _useState7 = useState(0),\n      _useState8 = _slicedToArray(_useState7, 2),\n      highlightedIndex = _useState8[0],\n      setHighlightedIndex = _useState8[1];\n\n  var defaultRef = /*#__PURE__*/createRef();\n  var selectUniqueId = useUniqueId('select'); // Need to set select options if options prop changes\n\n  useEffect(function () {\n    return setSelectOptions(flattenedOptions);\n  }, [flattenedOptions]); // Set the input's value to match the selected item\n\n  useEffect(function () {\n    setInputValue(selectedOption ? selectedOption.content : '');\n  }, [selectedOption]);\n  useEffect(function () {\n    setSelectedOption(findSelectedOption);\n  }, [findSelectedOption]);\n  var findSelectedOptionIndex = useMemo(function () {\n    return selectOptions.findIndex(function (item) {\n      return 'value' in item && item.value === value;\n    });\n  }, [selectOptions, value]);\n  useEffect(function () {\n    setHighlightedIndex(findSelectedOptionIndex);\n  }, [findSelectedOptionIndex]);\n\n  var handleSetInputValue = function handleSetInputValue(changes) {\n    if (filterable && changes.isOpen === true) {\n      setSelectOptions(filterOptions(changes.inputValue));\n      setInputValue(changes.inputValue || '');\n    }\n  };\n\n  var filterOptions = function filterOptions() {\n    var inputVal = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    return flattenedOptions.filter(function (option) {\n      return option.content === (action && action.content) || option.content.toLowerCase().startsWith(inputVal.trim().toLowerCase());\n    });\n  };\n\n  var handleOnHighlightedIndexChange = function handleOnHighlightedIndexChange(changes) {\n    if (typeof changes.highlightedIndex !== 'undefined') {\n      setHighlightedIndex(changes.highlightedIndex);\n    }\n  };\n\n  var handleOnIsOpenChange = function handleOnIsOpenChange(changes) {\n    if (filterable && changes.isOpen === false) {\n      // Reset the items if filtered\n      setSelectOptions(flattenedOptions);\n    }\n  };\n\n  var handleOnSelectedItemChange = function handleOnSelectedItemChange(changes) {\n    if (action && changes.selectedItem && changes.selectedItem.content === action.content) {\n      action.onActionClick(inputValue);\n    } else if (changes.selectedItem && 'value' in changes.selectedItem && typeof onOptionChange === 'function') {\n      onOptionChange(changes.selectedItem.value, changes.selectedItem);\n    }\n  };\n\n  var handleStateReducer = function handleStateReducer(state, actionAndChanges) {\n    switch (actionAndChanges.type) {\n      case useCombobox.stateChangeTypes.InputBlur:\n        return _objectSpread(_objectSpread({}, actionAndChanges.changes), {}, {\n          inputValue: selectedOption ? selectedOption.content : ''\n        });\n\n      case useCombobox.stateChangeTypes.InputKeyDownEnter:\n      case useCombobox.stateChangeTypes.ItemClick:\n        if ((actionAndChanges.changes.selectedItem && actionAndChanges.changes.selectedItem.content) === (action && action.content)) {\n          return _objectSpread(_objectSpread({}, actionAndChanges.changes), {}, {\n            inputValue: state.inputValue\n          });\n        }\n\n        return actionAndChanges.changes;\n\n      default:\n        return actionAndChanges.changes;\n    }\n  };\n\n  var _useCombobox = useCombobox({\n    highlightedIndex: highlightedIndex,\n    id: selectUniqueId,\n    inputId: id,\n    inputValue: inputValue,\n    itemToString: function itemToString(option) {\n      return option ? option.content : '';\n    },\n    items: selectOptions,\n    labelId: labelId,\n    onHighlightedIndexChange: handleOnHighlightedIndexChange,\n    onInputValueChange: handleSetInputValue,\n    onIsOpenChange: handleOnIsOpenChange,\n    onSelectedItemChange: handleOnSelectedItemChange,\n    selectedItem: selectedOption || null,\n    stateReducer: handleStateReducer\n  }),\n      closeMenu = _useCombobox.closeMenu,\n      getComboboxProps = _useCombobox.getComboboxProps,\n      getInputProps = _useCombobox.getInputProps,\n      getItemProps = _useCombobox.getItemProps,\n      getLabelProps = _useCombobox.getLabelProps,\n      getMenuProps = _useCombobox.getMenuProps,\n      getToggleButtonProps = _useCombobox.getToggleButtonProps,\n      isOpen = _useCombobox.isOpen,\n      openMenu = _useCombobox.openMenu; // Reset the value when Select is closed\n\n\n  useEffect(function () {\n    if (!isOpen) {\n      setInputValue(selectedOption ? selectedOption.content : '');\n    }\n  }, [isOpen, selectedOption]);\n  var setCallbackRef = useCallback(function (ref) {\n    if (typeof inputRef === 'function') {\n      inputRef(ref);\n    }\n  }, [inputRef]);\n  var getInputRef = useCallback(function () {\n    if (inputRef && _typeof(inputRef) === 'object') {\n      return inputRef;\n    } else if (typeof inputRef === 'function') {\n      return setCallbackRef;\n    }\n\n    return defaultRef;\n  }, [defaultRef, inputRef, setCallbackRef]);\n  var renderLabel = useMemo(function () {\n    if (!label) {\n      return null;\n    }\n\n    if (typeof label === 'string') {\n      return /*#__PURE__*/React.createElement(FormControlLabel, _extends({}, getLabelProps(), {\n        renderOptional: !required\n      }), label);\n    }\n\n    if ( /*#__PURE__*/ /*#__PURE__*/isValidElement(label) && label.type === FormControlLabel) {\n      return /*#__PURE__*/cloneElement(label, getLabelProps());\n    }\n\n    warning('label must be either a string or a FormControlLabel component.');\n  }, [getLabelProps, label, required]);\n  var renderToggle = useMemo(function () {\n    return /*#__PURE__*/React.createElement(DropdownButton, _extends({}, getToggleButtonProps({\n      disabled: disabled,\n      type: 'button'\n    }), {\n      \"aria-label\": \"toggle menu\",\n      variant: \"subtle\"\n    }), /*#__PURE__*/React.createElement(StyledDropdownIcon, null));\n  }, [disabled, getToggleButtonProps]);\n  var renderInput = useMemo(function () {\n    return /*#__PURE__*/React.createElement(Reference, null, function (_ref2) {\n      var ref = _ref2.ref;\n      return /*#__PURE__*/React.createElement(StyledInputContainer, {\n        ref: ref\n      }, /*#__PURE__*/React.createElement(Input, _extends({}, rest, getInputProps({\n        autoComplete: 'no',\n        disabled: disabled,\n        onClick: function onClick() {\n          !isOpen && openMenu();\n        },\n        onFocus: function onFocus() {\n          !isOpen && openMenu();\n        },\n        onKeyDown: function onKeyDown(event) {\n          switch (event.key) {\n            case 'Enter':\n              event.preventDefault();\n\n              if (isOpen === false) {\n                openMenu();\n                event.nativeEvent.preventDownshiftDefault = true;\n              }\n\n              break;\n\n            case 'Escape':\n              if (isOpen === false) {\n                // reset select\n                onOptionChange();\n                setHighlightedIndex(-1);\n              } else {\n                closeMenu();\n              }\n\n              event.nativeEvent.preventDownshiftDefault = true;\n              break;\n          }\n        },\n        placeholder: placeholder,\n        ref: getInputRef()\n      }), {\n        iconLeft: selectedOption === null || selectedOption === void 0 ? void 0 : selectedOption.icon,\n        iconRight: renderToggle,\n        readOnly: !filterable,\n        required: required\n      })));\n    });\n  }, [closeMenu, disabled, filterable, getInputProps, getInputRef, isOpen, onOptionChange, openMenu, selectedOption, placeholder, renderToggle, required, rest]);\n  var renderAction = useCallback(function (actionItem) {\n    var index = selectOptions.length - 1;\n    var isHighlighted = highlightedIndex === index;\n\n    var itemDisabled = actionItem.disabled,\n        content = actionItem.content,\n        icon = actionItem.icon,\n        onActionClick = actionItem.onActionClick,\n        itemProps = _objectWithoutProperties(actionItem, [\"disabled\", \"content\", \"icon\", \"onActionClick\"]);\n\n    return /*#__PURE__*/React.createElement(Box, {\n      borderTop: \"box\",\n      marginTop: \"xSmall\",\n      paddingTop: \"xSmall\",\n      key: \"\".concat(content, \"-\").concat(index)\n    }, /*#__PURE__*/React.createElement(ListItem, _extends({}, itemProps, getItemProps({\n      disabled: itemDisabled,\n      index: index,\n      item: actionItem\n    }), {\n      autoWidth: autoWidth,\n      isAction: true,\n      isHighlighted: isHighlighted\n    }), getContent(actionItem, isHighlighted)));\n  }, [getItemProps, autoWidth, highlightedIndex, selectOptions.length]);\n  var renderOptions = useCallback(function (items) {\n    return items.map(function (item) {\n      if (!selectOptions.find(function (option) {\n        return 'value' in option && option.value === item.value;\n      })) {\n        return null;\n      }\n\n      var key = itemKey.current;\n      itemKey.current += 1;\n      var isHighlighted = highlightedIndex === key;\n      var isSelected = selectedOption ? 'value' in item && selectedOption.value === item.value : false;\n\n      var itemDisabled = item.disabled,\n          content = item.content,\n          icon = item.icon,\n          itemProps = _objectWithoutProperties(item, [\"disabled\", \"content\", \"icon\"]);\n\n      return /*#__PURE__*/React.createElement(ListItem, _extends({}, itemProps, getItemProps({\n        disabled: itemDisabled,\n        index: key,\n        item: item\n      }), {\n        autoWidth: autoWidth,\n        isHighlighted: isHighlighted,\n        isSelected: isSelected,\n        key: \"\".concat(content, \"-\").concat(key)\n      }), getContent(item, isHighlighted), isSelected && /*#__PURE__*/React.createElement(CheckIcon, {\n        color: \"primary\",\n        size: \"large\"\n      }));\n    });\n  }, [getItemProps, autoWidth, highlightedIndex, selectedOption, selectOptions]);\n  var renderGroup = useCallback(function (group) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ListGroupHeader, null, group.label), renderOptions(group.options));\n  }, [renderOptions]);\n  var renderChildren = useMemo(function () {\n    itemKey.current = 0;\n\n    if (Array.isArray(options) && options.every(isGroup)) {\n      return /*#__PURE__*/React.createElement(React.Fragment, null, options.map(function (group, index) {\n        return /*#__PURE__*/React.createElement(Fragment, {\n          key: index\n        }, renderGroup(group));\n      }), action && renderAction(action));\n    }\n\n    if (Array.isArray(options) && options.every(function (item) {\n      return 'value' in item && !('options' in item);\n    })) {\n      return /*#__PURE__*/React.createElement(React.Fragment, null, renderOptions(options), action && renderAction(action));\n    }\n  }, [action, options, renderAction, renderGroup, renderOptions]);\n  var renderList = useMemo(function () {\n    return /*#__PURE__*/React.createElement(Popper, {\n      modifiers: [{\n        name: 'offset',\n        options: {\n          offset: [0, 4]\n        }\n      }],\n      placement: placement,\n      strategy: positionFixed ? 'fixed' : 'absolute'\n    }, function (_ref3) {\n      var popperPlacement = _ref3.placement,\n          ref = _ref3.ref,\n          popperStyle = _ref3.style,\n          update = _ref3.update;\n      return /*#__PURE__*/React.createElement(List, _extends({}, getMenuProps({\n        ref: ref\n      }), {\n        \"data-placement\": popperPlacement,\n        isOpen: isOpen,\n        maxHeight: maxHeight,\n        style: popperStyle,\n        update: update\n      }), isOpen && renderChildren);\n    });\n  }, [getMenuProps, isOpen, maxHeight, placement, positionFixed, renderChildren]);\n  return /*#__PURE__*/React.createElement(\"div\", null, /*#__PURE__*/React.createElement(Manager, null, renderLabel, /*#__PURE__*/React.createElement(\"div\", getComboboxProps(), renderInput), renderList));\n});\n\nvar flattenOptions = function flattenOptions(items) {\n  return items.every(isGroup) ? items.map(function (group) {\n    return group.options;\n  }).reduce(function (acc, curr) {\n    return acc.concat(curr);\n  }, []) : items;\n};\n\nvar isGroup = function isGroup(item) {\n  return 'options' in item && !('value' in item);\n};\n\nvar getContent = function getContent(item, isHighlighted) {\n  var content = item.content,\n      disabled = item.disabled,\n      description = item.description,\n      icon = item.icon;\n  return /*#__PURE__*/React.createElement(Flex, {\n    alignItems: \"center\",\n    flexDirection: \"row\"\n  }, icon && /*#__PURE__*/React.createElement(FlexItem, {\n    alignSelf: description ? 'flex-start' : undefined,\n    paddingRight: \"xSmall\",\n    paddingTop: description ? 'xSmall' : undefined\n  }, renderIcon(item, isHighlighted)), description ? /*#__PURE__*/React.createElement(FlexItem, {\n    paddingVertical: \"xSmall\"\n  }, content, /*#__PURE__*/React.createElement(Small, {\n    color: descriptionColor(disabled)\n  }, description)) : content);\n};\n\nvar renderIcon = function renderIcon(item, isHighlighted) {\n  return /*#__PURE__*/ /*#__PURE__*/isValidElement(item.icon) && /*#__PURE__*/cloneElement(item.icon, {\n    color: iconColor(item, isHighlighted),\n    size: 'large'\n  });\n};\n\nvar iconColor = function iconColor(item, isHighlighted) {\n  if (item.disabled) {\n    return 'secondary40';\n  }\n\n  if (!isHighlighted || !('onActionClick' in item)) {\n    return 'secondary60';\n  }\n\n  return 'actionType' in item ? item.actionType === 'destructive' ? 'danger50' : 'primary' : 'primary';\n};\n\nvar descriptionColor = function descriptionColor(isDisabled) {\n  return isDisabled ? 'secondary40' : 'secondary60';\n};","map":null,"metadata":{},"sourceType":"module"}